#!/bin/sh

# Staged files
STAGED_FILES=$(git diff --cached --name-only)

# Check if DEVLOG.md is staged for commit
if ! echo "$STAGED_FILES" | grep -q "DEVLOG.md"; then
  echo "Error: DEVLOG.md has not been updated or staged." >&2
  echo "Please update the devlog and stage it before committing." >&2
  exit 1
fi

# Check if TASKS.md is staged for commit
if ! echo "$STAGED_FILES" | grep -q "TASKS.md"; then
  echo "Error: TASKS.md has not been updated or staged." >&2
  echo "Please update the tasks list and stage it before committing." >&2
  exit 1
fi

# Check if src/gemini-cli submodule is pushed
cd src/gemini-cli || exit 1
if [ "$(git rev-parse @)" != "$(git rev-parse @{u})" ]; then
  echo "Error: src/gemini-cli submodule is not pushed to its remote." >&2
  echo "Please cd into src/gemini-cli and run 'git push' before committing." >&2
  exit 1
fi
cd ../.. || exit 1

# Check for unstaged changes in src/morpheum-bot
UNSTAGED_CHANGES=$(git diff --name-only src/morpheum-bot)
if [ -n "$UNSTAGED_CHANGES" ]; then
  echo "Error: There are unstaged changes in src/morpheum-bot:" >&2
  echo "$UNSTAGED_CHANGES" >&2
  echo "Please stage these files before committing." >&2
  exit 1
fi

exit 0